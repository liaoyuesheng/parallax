define((function(){"use strict";var t="object"==typeof global&&global&&global.Object===Object&&global,e="object"==typeof self&&self&&self.Object===Object&&self,s=(t||e||Function("return this")()).Symbol,n=Object.prototype,r=n.hasOwnProperty,i=n.toString,o=s?s.toStringTag:void 0;var c=Object.prototype.toString;var u=s?s.toStringTag:void 0;function h(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":u&&u in Object(t)?function(t){var e=r.call(t,o),s=t[o];try{t[o]=void 0;var n=!0}catch(t){}var c=i.call(t);return n&&(e?t[o]=s:delete t[o]),c}(t):function(t){return c.call(t)}(t)}function l(t){return null!=t&&"object"==typeof t}var a,p,f=(a=Object.getPrototypeOf,p=Object,function(t){return a(p(t))}),m=Function.prototype,d=Object.prototype,g=m.toString,b=d.hasOwnProperty,y=g.call(Object);function v(t){return l(t)&&1===t.nodeType&&!function(t){if(!l(t)||"[object Object]"!=h(t))return!1;var e=f(t);if(null===e)return!0;var s=b.call(e,"constructor")&&e.constructor;return"function"==typeof s&&s instanceof s&&g.call(s)==y}(t)}function _(t){const e=typeof t;if("function"!==e)throw new TypeError(`The "listener" argument must be of type Function. Received type ${e}`)}class j{constructor(){this._events={}}on(t,e,s=!1){_(e),this._events[t]||(this._events[t]=[]);const n=this._events[t];return s?n.unshift(e):n.push(e),this}off(t,e){const s=this._events[t];return s?(e?(_(e),this._events[t]=s.filter((t=>t!==e))):this._events[t]=[],this):this}once(t,e,s=!1){_(e);const n=(...s)=>{this.off(t,n),e.apply(this,s)};return this.on(t,n,s)}emit(t,...e){const s=this._events[t];return!(!s||!s.length)&&(s.forEach((t=>{t.apply(this,e)})),!0)}}class O{constructor(t){this.subs=[],this.data=t}addSub(t){this.subs.push(t),void 0!==this.data&&t.update(this.data)}notify(t){this.subs.forEach((e=>{e.update(t)}))}}function P(t){return t.match(/[$\d.]+/g).filter((t=>t)).map((t=>"$"===t[0]?t.substring(1):Number(t)))}class E{constructor(t){this.options=t,this.el=this.options.el,this.styleRenderer=function(t){const{startProgress:e,endProgress:s,startStyle:n,endStyle:r}=t,i=P(n),o=P(r);return function(t){const n=i.map(((n,r)=>{let i=o[r],c=!1;"string"==typeof n&&(n=Number(n),c=!0),"string"==typeof i&&(i=Number(i),c=!0);let u=(t-e)/(s-e)*(i-n)+n;const h=n<i?n:i,l=n<i?i:n;return u=Math.max(Math.min(u,l),h),c&&(u=Math.round(u),u<h&&(u=Math.ceil(h)),u>l&&(u=Math.floor(l))),u}));let c=0;return r.replace(/[$\d.]+/g,(()=>String(n[c++]).trim()))}}(t)}update(t){this.styleRenderer(t).split(";").forEach((t=>{if(!t)return;const e=t.split(":").map((t=>t.trim()));this.el.style[e[0]]=e[1]}))}}const S=["init","progress"];function A(t,e=document){if(v(t))return[t];if("string"==typeof t){const s=e.querySelectorAll(t);return Array.from(s)}return Array.from(t).filter((t=>v(t)))}const x={elements:".parallax-element",elementAttrPrefix:"parallax",customProgress:!1,startTop:0,endTop:-500,on:{}};return class{constructor(t){if(this._eventEmitter=new j,this.options=Object.assign({},x,t),!this.options.customProgress){const t=A(this.options.container,document)[0];if(!t)return this;this.container=t}this._initElements(),this._initEvents(),this.options.customProgress||(this._initScroll(),this.update(null,!0)),this._eventEmitter.emit("init",this)}_initElements(){this._dispatcher=new O;const t=A(this.options.elements,this.container);if(!t.length)return this;const e=this.options.elementAttrPrefix+"-start-progress",s=this.options.elementAttrPrefix+"-end-progress",n=this.options.elementAttrPrefix+"-start-style",r=this.options.elementAttrPrefix+"-end-style";t.forEach((t=>{const i=Number(t.getAttribute(e)||0),o=Number(t.getAttribute(s)||1),c=t.getAttribute(n),u=t.getAttribute(r);c&&u&&this._dispatcher.addSub(new E({el:t,startProgress:i,endProgress:o,startStyle:c,endStyle:u}))}))}_initScroll(t){(t?A(t)[0]:document).addEventListener("scroll",(()=>{this.update(null,!0)}))}_initEvents(){S.forEach((t=>{Object.prototype.hasOwnProperty.call(this.options.on,t)&&this._eventEmitter.on(t,this.options.on[t])}))}_updateProgress(){const t=this.container.getBoundingClientRect().top;return this.progress=function(t,e,s,n,r){let i=(t-e)/(s-e);return"number"==typeof n&&(i=Math.max(n,i)),"number"==typeof r&&(i=Math.min(r,i)),i}(t,this.options.startTop,this.options.endTop,0,1)}update(t,e=!1){const s=this.progress;if("number"==typeof t)t=Math.max(Math.min(t,1),0),this.progress=t;else{if(this.options.customProgress)return;this._updateProgress()}s!==this.progress&&(this._dispatcher.notify(this.progress),e&&this._eventEmitter.emit("progress",this,this.progress))}on(t,e){return function(t){S.indexOf(t)}(t),this._eventEmitter.on(t,e),this}}}));
//# sourceMappingURL=parallax.amd.min.js.map
