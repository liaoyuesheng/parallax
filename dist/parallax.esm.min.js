var t="object"==typeof global&&global&&global.Object===Object&&global,e="object"==typeof self&&self&&self.Object===Object&&self,s=(t||e||Function("return this")()).Symbol,r=Object.prototype,n=r.hasOwnProperty,o=r.toString,i=s?s.toStringTag:void 0;var c=Object.prototype.toString;var u=s?s.toStringTag:void 0;function l(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":u&&u in Object(t)?function(t){var e=n.call(t,i),s=t[i];try{t[i]=void 0;var r=!0}catch(t){}var c=o.call(t);return r&&(e?t[i]=s:delete t[i]),c}(t):function(t){return c.call(t)}(t)}function a(t){return null!=t&&"object"==typeof t}var h,p,f=(h=Object.getPrototypeOf,p=Object,function(t){return h(p(t))}),m=Function.prototype,d=Object.prototype,g=m.toString,b=d.hasOwnProperty,y=g.call(Object);function v(t){return a(t)&&1===t.nodeType&&!function(t){if(!a(t)||"[object Object]"!=l(t))return!1;var e=f(t);if(null===e)return!0;var s=b.call(e,"constructor")&&e.constructor;return"function"==typeof s&&s instanceof s&&g.call(s)==y}(t)}function _(t){const e=typeof t;if("function"!==e)throw new TypeError(`The "listener" argument must be of type Function. Received type ${e}`)}class j{constructor(){this._events={}}on(t,e,s=!1){_(e),this._events[t]||(this._events[t]=[]);const r=this._events[t];return s?r.unshift(e):r.push(e),this}off(t,e){const s=this._events[t];return s?(e?(_(e),this._events[t]=s.filter((t=>t!==e))):this._events[t]=[],this):this}once(t,e,s=!1){_(e);const r=(...s)=>{this.off(t,r),e.apply(this,s)};return this.on(t,r,s)}emit(t,...e){const s=this._events[t];return!(!s||!s.length)&&(s.forEach((t=>{t.apply(this,e)})),!0)}}class O{constructor(t){this.subs=[],this.data=t}addSub(t){this.subs.push(t),void 0!==this.data&&t.update(this.data)}notify(t){this.subs.forEach((e=>{e.update(t)}))}}function P(t){return t.match(/[$\d.]+/g).filter((t=>t)).map((t=>"$"===t[0]?t.substring(1):Number(t)))}class E{constructor(t){this.options=t,this.el=this.options.el,this.styleRenderer=function(t){const{startProgress:e,endProgress:s,startStyle:r,endStyle:n}=t,o=P(r),i=P(n);return function(t){const r=o.map(((r,n)=>{let o=i[n],c=!1;"string"==typeof r&&(r=Number(r),c=!0),"string"==typeof o&&(o=Number(o),c=!0);let u=(t-e)/(s-e)*(o-r)+r;const l=r<o?r:o,a=r<o?o:r;return u=Math.max(Math.min(u,a),l),c&&(u=Math.round(u),u<l&&(u=Math.ceil(l)),u>a&&(u=Math.floor(a))),u}));let c=0;return n.replace(/[$\d.]+/g,(()=>String(r[c++]).trim()))}}(t)}update(t){this.styleRenderer(t).split(";").forEach((t=>{if(!t)return;const e=t.split(":").map((t=>t.trim()));this.el.style[e[0]]=e[1]}))}}const S=["init","progress"];function x(t,e=document){if(v(t))return[t];if("string"==typeof t){const s=e.querySelectorAll(t);return Array.from(s)}return Array.from(t).filter((t=>v(t)))}const A={elements:".parallax-element",elementAttrPrefix:"parallax",customProgress:!1,startTop:0,endTop:-500,on:{}};class M{constructor(t){if(this._eventEmitter=new j,this.options=Object.assign({},A,t),!this.options.customProgress){const t=x(this.options.container,document)[0];if(!t)return this;this.container=t}this._initElements(),this._initEvents(),this.options.customProgress||(this._initScroll(),this.update(null,!0)),this._eventEmitter.emit("init",this)}_initElements(){this._dispatcher=new O;const t=x(this.options.elements,this.container);if(!t.length)return this;const e=this.options.elementAttrPrefix+"-start-progress",s=this.options.elementAttrPrefix+"-end-progress",r=this.options.elementAttrPrefix+"-start-style",n=this.options.elementAttrPrefix+"-end-style";t.forEach((t=>{const o=Number(t.getAttribute(e)||0),i=Number(t.getAttribute(s)||1),c=t.getAttribute(r),u=t.getAttribute(n);c&&u&&this._dispatcher.addSub(new E({el:t,startProgress:o,endProgress:i,startStyle:c,endStyle:u}))}))}_initScroll(t){(t?x(t)[0]:document).addEventListener("scroll",(()=>{this.update(null,!0)}))}_initEvents(){S.forEach((t=>{Object.prototype.hasOwnProperty.call(this.options.on,t)&&this._eventEmitter.on(t,this.options.on[t])}))}_updateProgress(){const t=this.container.getBoundingClientRect().top;return this.progress=function(t,e,s,r,n){let o=(t-e)/(s-e);return"number"==typeof r&&(o=Math.max(r,o)),"number"==typeof n&&(o=Math.min(n,o)),o}(t,this.options.startTop,this.options.endTop,0,1)}update(t,e=!1){const s=this.progress;if("number"==typeof t)t=Math.max(Math.min(t,1),0),this.progress=t;else{if(this.options.customProgress)return;this._updateProgress()}s!==this.progress&&(this._dispatcher.notify(this.progress),e&&this._eventEmitter.emit("progress",this,this.progress))}on(t,e){return function(t){S.indexOf(t)}(t),this._eventEmitter.on(t,e),this}}export{M as default};
//# sourceMappingURL=parallax.esm.min.js.map
